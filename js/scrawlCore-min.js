/*! scrawl 2014-07-30 */
"use strict";var scrawl=function(){var a={};return a.version="3.1.5",a.nameslist=["objectnames","padnames","cellnames","ctxnames","groupnames","designnames","spritenames"],a.sectionlist=["object","pad","cell","canvas","context","ctx","imageData","group","design","dsn","sprite"],a.radian=Math.PI/180,a.d={},a.v,a.workquat,a.f=document.createDocumentFragment(),a.cv=document.createElement("canvas"),a.cv.id="defaultHiddenCanvasElement",a.f.appendChild(a.cv),a.cvx=a.cv.getContext("2d"),a.loadAlias={block:"scrawlBlock",wheel:"scrawlWheel",phrase:"scrawlPhrase",path:"scrawlPath",shape:"scrawlShape",images:"scrawlImages",animation:"scrawlAnimation",collisions:"scrawlCollisions",factories:"scrawlPathFactories",color:"scrawlColor",filters:"scrawlFilters",physics:"scrawlPhysics",saveload:"scrawlSaveLoad",stacks:"scrawlStacks"},a.init=function(){return a.reset(),a.pageInit(),a.setDisplayOffsets("all"),a.animationInit(),a.physicsInit(),a},a.pageInit=function(){a.getCanvases()},a.animationInit=function(){},a.physicsInit=function(){},a.reset=function(){for(var b=0,c=a.nameslist.length;c>b;b++)a[a.nameslist[b]]=[];for(var b=0,c=a.sectionlist.length;c>b;b++)a[a.sectionlist[b]]={};return a},a.loadModules=function(b){b=a.safeObject(b);var c=b.path||"",d=a.isa(b.modules,"arr")?b.modules:[b.modules],e=a.isa(b.callback,"fn")?b.callback:function(){},f=a.xt(b.minified)?b.minified:!0,g=f?"-min.js":".js",h=[].concat(d),i=function(b){var d=document.createElement("script"),e=a.loadAlias[b]||b;d.type="text/javascript",d.async="true",d.onload=function(){console.log("... "+b+" loaded"),j(b)},d.src=/\.js$/.test(e)?c+e:c+e+g,document.body.appendChild(d)},j=function(b){a.removeItem(h,b),0===h.length&&(console.log("All modules loaded"),e())};console.log("Modules to be loaded: ",d);for(var k=0,l=d.length;l>k;k++)i(d[k]);return a},a.mergeInto=function(b,c){for(var d in c)c.hasOwnProperty(d)&&!a.xt(b[d])&&(b[d]=c[d]);return b},a.mergeOver=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.contains=function(a,b){for(var c in a)if(a[c]===b)return!0;return!1},a.pushUnique=function(b,c){return a.contains(b,c)||b.push(c),b},a.removeItem=function(b,c){if(a.contains(b,c)){var d=b.indexOf(c);b.splice(d,1)}return b},a.isBetween=function(a,b,c,d){if(b>c){var e=b;b=c,c=e}return d?a>=b&&c>=a?!0:!1:a>b&&c>a||a===b&&a===c?!0:!1},a.isa=function(b,c){if(a.xta([b,c])){var d=c.toLowerCase();switch(d){case"num":return"number"==typeof b?!0:!1;case"str":return"string"==typeof b?!0:!1;case"bool":return"boolean"==typeof b?!0:!1;case"fn":return"function"==typeof b?!0:!1;case"vector":return a.isa(b,"obj")&&a.xt(b.type)&&"Vector"===b.type?!0:!1;case"quaternion":return a.isa(b,"obj")&&a.xt(b.type)&&"Quaternion"===b.type?!0:!1;case"arr":return"[object Array]"===Object.prototype.toString.call(b)?!0:!1;case"obj":return"[object Object]"===Object.prototype.toString.call(b)?!0:!1;case"canvas":return"[object HTMLCanvasElement]"===Object.prototype.toString.call(b)?!0:!1;case"img":return"[object HTMLImageElement]"===Object.prototype.toString.call(b)?!0:!1;case"video":return"[object HTMLVideoElement]"===Object.prototype.toString.call(b)?!0:!1;case"date":return"[object Date]"===Object.prototype.toString.call(b)?!0:!1;default:return!1}}return!1},a.safeObject=function(b){return a.isa(b,"obj")?b:{}},a.xt=function(a){return"undefined"!=typeof a?!0:!1},a.xta=function(a){var b=[].concat(a);if(b.length>0){for(var c=0,d=b.length;d>c;c++)if("undefined"==typeof b[c])return!1;return!0}return!1},a.xto=function(a){var b=[].concat(a);if(b.length>0)for(var c=0,d=b.length;d>c;c++)if("undefined"!=typeof b[c])return!0;return!1},a.makeName=function(b){b=a.safeObject(b);var c,d,e={name:a.isa(b.name,"str")?b.name:null,type:a.isa(b.type,"str")?b.type:null,target:a.isa(b.target,"str")?b.target:null};return a.contains(a.nameslist,e.target)?(c=e.name||e.type||"default",d=c.split("~~~"),a.contains(a[e.target],d[0])?d[0]+"~~~"+Math.floor(1e8*Math.random()):d[0]):(console.log("scrawl.makeName() error: insufficient or incorrect argument attributes"),!1)},a.setDisplayOffsets=function(b){b=a.xt(b)?b:"all";for(var c=0,d=a.padnames.length;d>c;c++)a.pad[a.padnames[c]].setDisplayOffsets();return a},a.getCanvases=function(){var b,c=document.getElementsByTagName("canvas"),d=[];if(c.length>0){for(var e=0,f=c.length;f>e;e++)d.push(c[e]);for(var e=0,f=c.length;f>e;e++)b=a.newPad({canvasElement:d[e]}),0===e&&(a.currentPad=b.name);return!0}return console.log("scrawl.getCanvases() failed to find any <canvas> elements on the page"),!1},a.addCanvasToPage=function(b){b=a.safeObject(b);var c,d,e,f,g;return c=document.getElementById(b.parentElement)||document.body,d=a.makeName({name:b.canvasName||b.name||!1,type:"Pad",target:"padnames"}),e=document.createElement("canvas"),e.id=d,c.appendChild(e),f=document.getElementById(d),f.width=b.width,f.height=b.height,g=a.newPad({canvasElement:f}),g.set(b),a.setDisplayOffsets(),g},a.prepareFilterSection=function(){return a.xt(a.filter)||(a.filter={},a.filternames=[]),a},a.setDrawOrder=function(b,c){for(var d=a.xt(c)?[].concat(c):[a.currentPad],e=0,f=d.length;f>e;e++)a.pad[d[e]].setDrawOrder(b);return a},a.clear=function(b,c){var d=a.xt(c)?[].concat(c):a.padnames;if(d.length>0)for(var e=0,f=d.length;f>e;e++)a.pad[d[e]].clear(b);return a},a.stampBackground=function(b,c){var d=a.xt(c)?[].concat(c):a.padnames;if(d.length>0)for(var e=0,f=d.length;f>e;e++)a.pad[d[e]].stampBackground(b);return a},a.compile=function(b,c){var d=a.xt(c)?[].concat(c):a.padnames;if(d.length>0)for(var e=0,f=d.length;f>e;e++)a.pad[d[e]].compile(b);return a},a.show=function(b,c){var d=a.xt(c)?[].concat(c):a.padnames;if(d.length>0)for(var e=0,f=d.length;f>e;e++)a.pad[d[e]].show(b);return a},a.render=function(b,c){var d=a.xt(c)?[].concat(c):a.padnames;if(d.length>0)for(var e=0,f=d.length;f>e;e++)a.pad[d[e]].render(b);return a},a.addNewCell=function(b,c){var d=a.isa(c,"str")?c:a.currentPad;return a.pad[d].addNewCell(b)},a.deleteCells=function(b){if(a.xt(b))for(var c=[].concat(b),d=0,e=c.length;e>d;d++){for(var f=0,g=a.padnames.length;g>f;f++)a.pad[a.padnames[f]].deleteCell(c[d]);delete a.group[c[d]],delete a.group[c[d]+"_field"],delete a.group[c[d]+"_fence"],a.removeItem(a.groupnames,c[d]),a.removeItem(a.groupnames,c[d]+"_field"),a.removeItem(a.groupnames,c[d]+"_fence"),delete a.context[c[d]],delete a.canvas[c[d]],delete a.ctx[a.cell[c[d]].context],a.removeItem(a.ctxnames,a.cell[c[d]].context),delete a.cell[c[d]],a.removeItem(a.cellnames,c[d])}return a},a.getImageDataValue=function(b){if(b=a.safeObject(b),a.xta([b.table,b.channel])&&a.isa(b.x,"num")&&a.isa(b.y,"num")){var c,d,e,f;if(c=a.imageData[b.table],c&&a.isBetween(b.y,-1,c.height)&&a.isBetween(b.x,-1,c.width)){if(d=4*(b.y*c.width+b.x),"color"===b.channel)e="rgba("+c.data[d]+","+c.data[d+1]+","+c.data[d+2]+","+c.data[d+3]+")";else{switch(b.channel){case"red":f=0;break;case"blue":f=1;break;case"green":f=2;break;case"alpha":f=3}e=c.data[d+f]}return e}}return console.log("scrawl.getImageDataValue() error: insufficient or incorrect arguments; or imageData does not exist; or coordinates are out of bounds"),!1},a.addSpritesToGroups=function(b,c){if(a.xta([b,c]))for(var d=[].concat(b),e=[].concat(c),f=0,g=d.length;g>f;f++)a.contains(a.groupnames,d[f])&&a.group[d[f]].addSpritesToGroup(e);return a},a.removeSpritesFromGroups=function(b,c){if(a.xta([b,c]))for(var d=[].concat(b),e=[].concat(c),f=0,g=d.length;g>f;f++)a.contains(a.groupnames,d[f])&&a.group[d[f]].removeSpritesFromGroup(e);return a},a.deleteSprite=function(b){for(var c,d,e=a.isa(b,"str")?[b]:[].concat(b),f=0,g=e.length;g>f;f++)if(a.contains(a.spritenames,e[f])){d=a.sprite[e[f]],a.pathDeleteSprite(d),c=d.context,a.removeItem(a.ctxnames,c),delete a.ctx[c],a.removeItem(a.spritenames,e[f]),delete a.sprite[e[f]];for(var h=0,i=a.groupnames.length;i>h;h++)a.removeItem(a.group[a.groupnames[h]].sprites,e[f])}return a},a.pathDeleteSprite=function(){},a.newVector=function(b){return new a.Vector(b)},a.newQuaternion=function(b){return new a.Quaternion(b)},a.makeQuaternion=function(b){return a.Quaternion.prototype.makeFromEuler(b)},a.newPad=function(b){return new a.Pad(b)},a.newCell=function(b){return new a.Cell(b)},a.newContext=function(b){return new a.Context(b)},a.newGroup=function(b){return new a.Group(b)},a.newGradient=function(b){return new a.Gradient(b)},a.newRadialGradient=function(b){return new a.RadialGradient(b)},a.Vector=function(b){return b=a.safeObject(b),this.x=b.x||0,this.y=b.y||0,this.z=b.z||0,this.name=b.name||"generic",this},a.Vector.prototype=Object.create(Object.prototype),a.Vector.prototype.type="Vector",a.d.Vector={x:0,y:0,z:0,name:"generic"},a.Vector.prototype.setMagnitudeTo=function(a){return this.normalize(),this.scalarMultiply(a),this.getMagnitude()!==a&&(this.normalize(),this.scalarMultiply(a),this.getMagnitude()!==a&&(this.normalize(),this.scalarMultiply(a))),this},a.Vector.prototype.normalize=function(){var a=this.getMagnitude();return a>0&&(this.x/=a,this.y/=a,this.z/=a),this},a.Vector.prototype.zero=function(){return this.x=0,this.y=0,this.z=0,this},a.Vector.prototype.set=function(b){return b=a.safeObject(b),this.x=a.xt(b.x)?b.x:this.x,this.y=a.xt(b.y)?b.y:this.y,this.z=a.xt(b.z)?b.z:this.z,this},a.Vector.prototype.isEqual=function(b){return a.isa(b,"vector")&&this.x===b.x&&this.y===b.y&&this.z===b.z?!0:!1},a.Vector.prototype.isLike=function(b){return a.isa(b,"obj")&&this.x===b.x&&this.y===b.y&&this.z===b.z?!0:!1},a.Vector.prototype.getData=function(){return{x:this.x,y:this.y,z:this.z}},a.Vector.prototype.hasCoordinates=function(b){return a.xta([b,b.x,b.y])?!0:!1},a.Vector.prototype.vectorAdd=function(b){return b=a.safeObject(b),this.x+=b.x||0,this.y+=b.y||0,this.z+=b.z||0,this},a.Vector.prototype.vectorSubtract=function(b){return b=a.safeObject(b),this.x-=b.x||0,this.y-=b.y||0,this.z-=b.z||0,this},a.Vector.prototype.vectorMultiply=function(b){return b=a.safeObject(b),this.x*=b.x||1,this.y*=b.y||1,this.z*=b.z||1,this},a.Vector.prototype.vectorDivide=function(b){return b=a.safeObject(b),this.x/=0!==(b.x||0)?b.x:1,this.y/=0!==(b.y||0)?b.y:1,this.z/=0!==(b.z||0)?b.z:1,this},a.Vector.prototype.scalarMultiply=function(b){return a.isa(b,"num")?(this.x*=b,this.y*=b,this.z*=b,this):(console.log("Vector.scalarMultiply() error: argument is not a number"),this)},a.Vector.prototype.scalarDivide=function(b){return a.isa(b,"num")&&0!==b?(this.x/=b,this.y/=b,this.z/=b,this):(console.log("Vector.scalarDivide() error: argument is not a number, or is zero"),this)},a.Vector.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},a.Vector.prototype.checkNotZero=function(){return this.x||this.y||this.z?!0:!1},a.Vector.prototype.getVector=function(){return console.log("Vector.getVector"),a.newVector({x:this.x,y:this.y,z:this.z})},a.Vector.prototype.getCrossProduct=function(b,c){if(console.log("Vector.getCrossProduct"),a.isa(b,"vector")){c=a.isa(c,"vector")?c:this;var d=c.x||0,e=c.y||0,f=c.z||0,g=b.x||0,h=b.y||0,i=b.z||0;return a.newVector({x:e*i-f*h,y:-(d*i)+f*g,z:d*h+e*g})}return console.log("Vector.getCrossProduct() error: argument is not a Vector"),this},a.Vector.prototype.getDotProduct=function(b,c){return a.isa(b,"vector")?(c=a.isa(c,"vector")?c:this,(b.x||0)*(c.x||0)+(b.y||0)*(c.y||0)+(b.z||0)*(c.z||0)):(console.log("Vector.getDotProduct() error: argument is not a Vector"),!1)},a.Vector.prototype.getTripleScalarProduct=function(b,c,d){if(a.isa(b,"vector")&&a.isa(c,"vector")){d=a.safeObject(d)?d:this;var e=b.x||0,f=b.y||0,g=b.z||0,h=c.x||0,i=c.y||0,j=c.z||0,k=d.x||0,l=d.y||0,m=d.z||0;return e*(i*m-j*l)+f*(-(h*m)+j*k)+g*(h*l-i*k)}return console.log("Vector.getTripleScalarProduct() error: argument is not a Vector"),!1},a.Vector.prototype.rotate=function(b){if(a.isa(b,"num")){var c=Math.atan2(this.y,this.x);c+=b*a.radian;var d=this.getMagnitude();return this.x=d*Math.cos(c),this.y=d*Math.sin(c),this}return console.log("Vector.rotate() error: argument is not a Number"),this},a.Vector.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},a.Vector.prototype.rotate3d=function(b,c){if(a.isa(b,"quaternion")){c=scrawl.isa(c,"num")?c:this.getMagnitude();var d=a.workquat.q1.set(b),e=a.workquat.q2.set(this),f=a.workquat.q3.set(b).conjugate();return d.quaternionMultiply(e),d.quaternionMultiply(f),this.set(d.v).setMagnitudeTo(c),this}return console.log("Vector.rotate3d() error: argument is not a Quaternion"),this},a.Quaternion=function(b){b=a.safeObject(b);var c=a.safeObject(b.v);return this.name=b.name||"generic",this.n=b.n||1,this.v=a.newVector({x:c.x||b.x||0,y:c.y||b.y||0,z:c.z||b.z||0}),this},a.Quaternion.prototype=Object.create(Object.prototype),a.Quaternion.prototype.type="Quaternion",a.d.Quaternion={name:"generic",n:1,v:{x:0,y:0,z:0}},a.Quaternion.prototype.zero=function(){return this.n=1,this.v.x=0,this.v.y=0,this.v.z=0,this},a.Quaternion.prototype.getMagnitude=function(){return Math.sqrt(this.n*this.n+this.v.x*this.v.x+this.v.y*this.v.y+this.v.z*this.v.z)},a.Quaternion.prototype.normalize=function(){var a=this.getMagnitude();return 0!==a&&(this.n/=a,this.v.x/=a,this.v.y/=a,this.v.z/=a),this},a.Quaternion.prototype.checkNormal=function(b){b=a.xt(b)?b:0;var c=this.getMagnitude();return c>=1-b&&1+b>=c?!0:!1},a.Quaternion.prototype.getVector=function(){return this.v},a.Quaternion.prototype.getScalar=function(){return this.n},a.Quaternion.prototype.quaternionAdd=function(b){return a.isa(b,"quaternion")?(this.n+=b.n||0,this.v.x+=b.v.x||0,this.v.y+=b.v.y||0,this.v.z+=b.v.z||0,this):(console.log("Quaternion.quaternionAdd() error: argument is not a Quaternion object"),this)},a.Quaternion.prototype.quaternionSubtract=function(b){return a.isa(b,"quaternion")?(this.n-=b.n||0,this.v.x-=b.v.x||0,this.v.y-=b.v.y||0,this.v.z-=b.v.z||0,this):(console.log("Quaternion.quaternionSubtract() error: argument is not a Quaternion object"),this)},a.Quaternion.prototype.scalarMultiply=function(b){return a.isa(b,"num")?(this.n*=b,this.v.x*=b,this.v.y*=b,this.v.z*=b,this):(console.log("Quaternion.scalarMultiply() error: argument is not a number"),this)},a.Quaternion.prototype.scalarDivide=function(b){return a.isa(b,"num")&&0!==b?(this.n/=b,this.v.x/=b,this.v.y/=b,this.v.z/=b,this):(console.log("Quaternion.scalarMultiply() error: argument is not a number, or is zero"),this)},a.Quaternion.prototype.conjugate=function(){return this.v.x=-this.v.x,this.v.y=-this.v.y,this.v.z=-this.v.z,this},a.Quaternion.prototype.set=function(b){b=a.safeObject(b);var c,d,e,f,g;return a.isa(b,"quaternion")?this.setFromQuaternion(b):a.isa(b,"vector")?this.setFromVector(b):a.xto([b.pitch,b.yaw,b.roll])?this.setFromEuler(b):(g=a.xt(b.vector)||a.xt(b.v)?b.vector||b.v:!1,f=a.xt(b.scalar)||a.xt(b.n)?b.scalar||b.n||0:!1,c=g?g.x||0:b.x,d=g?g.y||0:b.y,e=g?g.z||0:b.z,this.n=a.isa(f,"num")?f:this.n,this.v.x=a.isa(c,"num")?c:this.v.x,this.v.y=a.isa(d,"num")?d:this.v.y,this.v.z=a.isa(e,"num")?e:this.v.z,this)},a.Quaternion.prototype.setFromQuaternion=function(b){return a.isa(b,"quaternion")?(this.n=b.n,this.v.x=b.v.x,this.v.y=b.v.y,this.v.z=b.v.z,this):(console.log("Quaternion.setFromQuaternion() error: argument is not a Quaternion object"),this)},a.Quaternion.prototype.setFromVector=function(b){return a.isa(b,"vector")?(this.n=0,this.v.x=b.x,this.v.y=b.y,this.v.z=b.z,this):(console.log("Quaternion.setFromVector() error: argument is not a Vector object"),this)},a.Quaternion.prototype.quaternionMultiply=function(b){if(a.isa(b,"quaternion")){var c=this.n,d=this.v.x,e=this.v.y,f=this.v.z,g=b.n,h=b.v.x,i=b.v.y,j=b.v.z;return this.n=c*g-d*h-e*i-f*j,this.v.x=c*h+d*g+e*j-f*i,this.v.y=c*i+e*g+f*h-d*j,this.v.z=c*j+f*g+d*i-e*h,this}return console.log("Quaternion.quaternionMultiply() error: argument is not a Quaternion object"),this},a.Quaternion.prototype.vectorMultiply=function(b){if(a.isa(b,"vector")){var c=this.n,d=this.v.x,e=this.v.y,f=this.v.z,g=b.x,h=b.y,i=b.z;return this.n=-(d*g+e*h+f*i),this.v.x=c*g+e*i-f*h,this.v.y=c*h+f*g-d*i,this.v.z=c*i+d*h-e*g,this}return console.log("Quaternion.vectorMultiply() error: argument is not a Vector object"),this},a.Quaternion.prototype.getAngle=function(b){b=a.xt(b)?b:!1;var c=2*Math.acos(this.n);return b?c*(1/a.radian):c},a.Quaternion.prototype.getAxis=function(){var b=a.v.set(this.v),c=this.getMagnitude();return 0!==c?b.scalarDivide(c):b},a.Quaternion.prototype.quaternionRotate=function(b){if(a.isa(b,"quaternion")){var c=a.workquat.q4.set(b),d=a.workquat.q5.set(this);return this.set(c.quaternionMultiply(d))}return console.log("Quaternion.quaternionRotate() error: argument is not a Quaternion object"),this},a.Quaternion.prototype.vectorRotate=function(b){return a.isa(b,"vector")?b.rotate3d(this):(console.log("Quaternion.vectorRotate() error: argument is not a Vector object"),!1)},a.Quaternion.prototype.makeFromEuler=function(b){console.log("makeFromEuler"),b=a.safeObject(b);var c=(b.pitch||b.x||0)*a.radian,d=(b.yaw||b.y||0)*a.radian,e=(b.roll||b.z||0)*a.radian,f=Math.cos(d/2),g=Math.cos(e/2),h=Math.cos(c/2),i=Math.sin(d/2),j=Math.sin(e/2),k=Math.sin(c/2),l=f*g*h-i*j*k,m=i*j*h+f*g*k,n=i*g*h+f*j*k,o=f*j*h-i*g*k;return a.newQuaternion({n:l,x:m,y:n,z:o})},a.Quaternion.prototype.setFromEuler=function(b){b=a.safeObject(b);var c=(b.pitch||b.x||0)*a.radian,d=(b.yaw||b.y||0)*a.radian,e=(b.roll||b.z||0)*a.radian,f=Math.cos(d/2),g=Math.cos(e/2),h=Math.cos(c/2),i=Math.sin(d/2),j=Math.sin(e/2),k=Math.sin(c/2),l=f*g*h-i*j*k,m=i*j*h+f*g*k,n=i*g*h+f*j*k,o=f*j*h-i*g*k;return this.set({n:l,x:m,y:n,z:o})},a.Quaternion.prototype.getEulerAngles=function(){var b,c,d=this.n*this.n,e=this.v.x*this.v.x,f=this.v.y*this.v.y,g=this.v.z*this.v.z,h=d+e+f+g,i=this.v.x*this.v.y+this.v.z*this.n,j={pitch:0,yaw:0,roll:0};return i>.499999*h?(j.yaw=2*Math.atan2(this.v.x,this.n)/a.radian,j.roll=Math.PI/2/a.radian,j.pitch=0,j):-.499999*h>i?(j.yaw=-2*Math.atan2(this.v.x,this.n)/a.radian,j.roll=-Math.PI/2/a.radian,j.pitch=0,j):(b=2*this.v.y*this.n-2*this.v.x*this.v.z,c=e-f-g+d,j.yaw=Math.atan2(b,c)/a.radian,j.roll=Math.asin(2*i/h)/a.radian,b=2*this.v.x*this.n-2*this.v.y*this.v.z,c=f-e-g+d,j.pitch=Math.atan2(b,c)/a.radian,j)},a.Base=function(b){return b=a.safeObject(b),this.name=a.makeName({name:b.name||"",type:this.type,target:this.classname}),this.work={},this},a.Base.prototype=Object.create(Object.prototype),a.Base.prototype.type="Base",a.Base.prototype.classname="objectnames",a.d.Base={comment:"",title:"",timestamp:""},a.Base.prototype.get=function(b){return a.xt(this[b])?this[b]:a.d[this.type][b]},a.Base.prototype.set=function(b){for(var c in b)a.xt(a.d[this.type][c])&&(this[c]=b[c]);return this},a.Base.prototype.clone=function(b){var c=a.mergeOver(this.parse(),a.safeObject(b));return delete c.context,new a[this.type](c)},a.Base.prototype.parse=function(){return JSON.parse(JSON.stringify(this))},a.Base.prototype.resetWork=function(){for(var a=Object.keys(this.work),b=0,c=a.length;c>b;b++)this.work[a[b]].set(this[a[b]]);return!0},a.Position=function(b){return a.Base.call(this,b),b=a.safeObject(b),this.corePositionInit(b),this.animationPositionInit(b),this.pathPositionInit(b),this},a.Position.prototype=Object.create(a.Base.prototype),a.Position.prototype.type="Position",a.Position.prototype.classname="objectnames",a.d.Position={start:{x:0,y:0,z:0},handle:{x:0,y:0,z:0},pivot:"",scale:1,flipReverse:!1,flipUpend:!1,lockX:!1,lockY:!1,roll:0,width:0,height:0},a.mergeInto(a.d.Position,a.d.Base),a.Position.prototype.corePositionInit=function(b){var c=a.safeObject(b.start);this.start=a.newVector({x:a.xt(b.startX)?b.startX:a.xt(c.x)?c.x:0,y:a.xt(b.startY)?b.startY:a.xt(c.y)?c.y:0,name:this.type+"."+this.name+".start"}),this.work.start=a.newVector({name:this.type+"."+this.name+".work.start"}),c=a.safeObject(b.handle),this.handle=a.newVector({x:a.xt(b.handleX)?b.handleX:a.xt(c.x)?c.x:0,y:a.xt(b.handleY)?b.handleY:a.xt(c.y)?c.y:0,name:this.type+"."+this.name+".handle"}),this.work.handle=a.newVector({name:this.type+"."+this.name+".work.handle"}),this.pivot=b.pivot||a.d[this.type].pivot,this.scale=a.isa(b.scale,"num")?b.scale:a.d[this.type].scale,this.roll=a.isa(b.roll,"num")?b.roll:a.d[this.type].roll,this.flipReverse=a.isa(b.flipReverse,"bool")?b.flipReverse:a.d[this.type].flipReverse,this.flipUpend=a.isa(b.flipUpend,"bool")?b.flipUpend:a.d[this.type].flipUpend,this.lockX=a.isa(b.lockX,"bool")?b.lockX:a.d[this.type].lockX,this.lockY=a.isa(b.lockY,"bool")?b.lockY:a.d[this.type].lockY,this.offset=a.newVector({name:this.type+"."+this.name+".offset"}),this.offset.flag=!1},a.Position.prototype.animationPositionInit=function(){},a.Position.prototype.pathPositionInit=function(){},a.Position.prototype.get=function(b){if(a.contains(["startX","startY","handleX","handleY"],b))switch(b){case"startX":return this.start.x;case"startY":return this.start.y;case"handleX":return this.handle.x;case"handleY":return this.handle.y}return this.animationPositionGet(b)||a.Base.prototype.get.call(this,b)},a.Position.prototype.animationPositionGet=function(){return!1},a.Position.prototype.set=function(b){return b=a.safeObject(b),a.Base.prototype.set.call(this,b),a.isa(this.start,"vector")||(this.start=a.newVector(b.start||this.start)),a.xto([b.startX,b.startY])&&(this.start.x=a.xt(b.startX)?b.startX:this.start.x,this.start.y=a.xt(b.startY)?b.startY:this.start.y),a.isa(this.handle,"vector")||(this.handle=a.newVector(b.handle||this.handle)),a.xto([b.handleX,b.handleY])&&(this.handle.x=a.xt(b.handleX)?b.handleX:this.handle.x,this.handle.y=a.xt(b.handleY)?b.handleY:this.handle.y),this.animationPositionSet(b),this},a.Position.prototype.animationPositionSet=function(){},a.Position.prototype.setDelta=function(b){b=a.safeObject(b);var c;return a.xto([b.start,b.startX,b.startY])&&(c=a.safeObject(b.start),this.start.x+=a.xt(b.startX)?b.startX:a.xt(c.x)?c.x:0,this.start.y+=a.xt(b.startY)?b.startY:a.xt(c.y)?c.y:0),a.Position.prototype.pathPositionSetDelta.call(this,b),a.xto([b.handle,b.handleX,b.handleY])&&a.isa(this.handle.x,"num")&&a.isa(this.handle.y,"num")&&(c=a.safeObject(b.handle),this.handle.x+=a.xt(b.handleX)?b.handleX:a.xt(c.x)?c.x:0,this.handle.y+=a.xt(b.handleY)?b.handleY:a.xt(c.y)?c.y:0),b.scale&&(this.scale+=b.scale),this},a.Position.prototype.pathPositionSetDelta=function(){},a.Position.prototype.clone=function(b){b=a.safeObject(b);var c,d=a.Base.prototype.clone.call(this,b);return c=a.safeObject(b.start),d.start=a.newVector({x:a.xt(b.startX)?b.startX:a.xt(c.x)?c.x:d.start.x,y:a.xt(b.startY)?b.startY:a.xt(c.y)?c.y:d.start.y,name:d.type+"."+d.name+".start"}),c=a.safeObject(b.handle),d.handle=a.newVector({x:a.xt(b.handleX)?b.handleX:a.xt(c.x)?c.x:d.handle.x,y:a.xt(b.handleY)?b.handleY:a.xt(c.y)?c.y:d.handle.y,name:d.type+"."+d.name+".handle"}),d=this.animationPositionClone(d,b)},a.Position.prototype.animationPositionClone=function(a){return a},a.Position.prototype.getPivotOffsetVector=function(){var b=this.work.handle,c=this.targetHeight||this.height||this.get("height"),d=this.targetWidth||this.width||this.get("width");return a.Position.prototype.calculatePOV.call(this,b,d,c,!1)},a.Position.prototype.getCenteredPivotOffsetVector=function(){var b=this.work.handle,c=this.targetHeight||this.height||this.get("height"),d=this.targetWidth||this.width||this.get("width");return a.Position.prototype.calculatePOV.call(this,b,d,c,!0)},a.Position.prototype.calculatePOV=function(b,c,d,e){if(c=a.isa(c,"num")?c:0,d=a.isa(d,"num")?d:0,e=a.isa(e,"bool")?e:!1,a.isa(b.x,"str")&&!a.contains(["left","center","right"],b.x))b.x=e?parseFloat(b.x)/100*c-c/2:parseFloat(b.x)/100*c;else switch(b.x){case"left":b.x=e?-(c/2):0;break;case"center":b.x=e?0:c/2;break;case"right":b.x=e?c/2:c}if(a.isa(b.y,"str")&&!a.contains(["top","center","bottom"],b.y))b.y=e?parseFloat(b.y)/100*d-d/2:parseFloat(b.y)/100*d;else switch(b.y){case"top":b.y=e?-(d/2):0;break;case"center":b.y=e?0:d/2;break;case"bottom":b.y=e?d/2:d}return b},a.Position.prototype.getOffsetStartVector=function(){this.resetWork();var b=a.isa(this.handle.x,"str")?this.scale:1,c=a.isa(this.handle.y,"str")?this.scale:1,d=this.getPivotOffsetVector();return d.x*=b,d.y*=c,d.reverse()},a.Position.prototype.setStampUsingPivot=function(b){var c,d,e;if(a.xt(a.pointnames)&&a.contains(a.pointnames,this.pivot))return c=a.point[this.pivot],e=a.sprite[c.sprite],d=c.getCurrentCoordinates().rotate(e.roll).vectorAdd(e.start),this.start.x=this.lockX?this.start.x:d.x,this.start.y=this.lockY?this.start.y:d.y,this;if(a.contains(a.spritenames,this.pivot))return c=a.sprite[this.pivot],d="Particle"===c.type?c.get("place"):c.start,this.start.x=this.lockX?this.start.x:d.x,this.start.y=this.lockY?this.start.y:d.y,this;if("mouse"===this.pivot){var f=a.cell[b],g=a.pad[f.pad],h=this.correctCoordinates(g.mouse,b);a.xta([this.oldX,this.oldY])||(this.oldX=this.start.x,this.oldY=this.start.y),this.start.x=this.lockX?this.start.x:this.start.x+h.x-this.oldX,this.start.y=this.lockY?this.start.y:this.start.y+h.y-this.oldY,this.oldX=h.x,this.oldY=h.y}return this},a.Position.prototype.correctCoordinates=function(b,c){b=a.safeObject(b);var d=a.v.set(b);if(scrawl.xta([b.x,b.y])){c=a.contains(a.cellnames,c)?a.cell[c]:a.cell[a.pad[a.currentPad].base];var e=a.pad[c.pad];return e.width!==c.actualWidth&&(d.x/=e.width/c.actualWidth),e.height!==c.actualHeight&&(d.y/=e.height/c.actualHeight),d}return!1},a.PageElement=function(b){return b=a.safeObject(b),a.Base.call(this,b),this.scale=a.isa(b.scale,"num")?b.scale:a.d[this.type].scale,this.stacksPageElementConstructor(b),this},a.PageElement.prototype=Object.create(a.Base.prototype),a.PageElement.prototype.type="PageElement",a.PageElement.prototype.classname="objectnames",a.d.PageElement={width:300,height:150,displayOffsetX:0,displayOffsetY:0,scale:1,mouse:!1,position:"static"},a.mergeInto(a.d.PageElement,a.d.Base),a.PageElement.prototype.stacksPageElementConstructor=function(){},a.PageElement.prototype.get=function(b){var c=this.getElement();if(a.contains(["width","height"],b))switch(b){case"width":return this.width||parseFloat(c.width)||a.d[this.type].width;case"height":return this.height||parseFloat(c.height)||a.d[this.type].height;case"position":return this.position||c.style.position}return a.Base.prototype.get.call(this,b)},a.PageElement.prototype.set=function(b){b=a.safeObject(b),a.Base.prototype.set.call(this,b);this.getElement();return a.xto([b.width,b.height,b.scale])&&(this.setDimensions(),this.setDisplayOffsets()),a.xt(b.position)&&(this.position=b.position),a.xt(b.mouse)&&this.initMouse({mouse:b.mouse}),a.xt(b.pivot)&&(this.pivot=b.pivot,this.pivot||(delete this.oldX,delete this.oldY)),a.xto([b.title,b.comment])&&this.setAccessibility(b),this},a.PageElement.prototype.setAccessibility=function(b){b=a.safeObject(b);var c=this.getElement();return a.xt(b.title)&&(this.title=b.title,c.title=this.title),a.xt(b.comment)&&(this.comment=b.comment,c.setAttribute("data-comment",this.comment)),this},a.PageElement.prototype.setDisplayOffsets=function(){var a=0,b=0,c=this.getElement();if(c.offsetParent)do a+=c.offsetLeft,b+=c.offsetTop;while(c=c.offsetParent);return this.displayOffsetX=a,this.displayOffsetY=b,this},a.PageElement.prototype.scaleDimensions=function(b){return a.isa(b,"num")&&(this.scale=b,this.setDimensions()),this},a.PageElement.prototype.setDimensions=function(){var a=this.getElement();return a.style.width=this.width*this.scale+"px",a.style.height=this.height*this.scale+"px",this},a.PageElement.prototype.getMouse=function(){return this.mouse},a.PageElement.prototype.handleMouseMove=function(b){b=a.xt(b)?b:window.event;var c,d,e=scrawl.pad[b.target.id]||scrawl.stack[b.target.id]||scrawl.element[b.target.id]||!1,f=0,g=0;return e&&(e.mouse.active=!1,e.mouse.element=e.name,e.mouse.type=e.type,e.mouse.layer||a.xta([b,b.layerX])&&a.contains(["relative","absolute","fixed","sticky"],e.position)?(f=b.layerX,g=b.layerY,f>=0&&f<=e.width*e.scale&&g>=0&&g<=e.height*e.scale&&(e.mouse.active=!0),e.mouse.x=b.layerX*(1/e.scale),e.mouse.y=b.layerY*(1/e.scale),e.mouse.layer=!0):(b.pageX||b.pageY?(f=b.pageX,g=b.pageY):(b.clientX||b.clientY)&&(f=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,g=b.clientY+document.body.scrollTop+document.documentElement.scrollTop),c=e.displayOffsetX+e.width*e.scale,d=e.displayOffsetY+e.height*e.scale,f>=e.displayOffsetX&&c>=f&&g>=e.displayOffsetY&&d>=g&&(e.mouse.active=!0),e.mouse.x=(f-e.displayOffsetX)*(1/e.scale),e.mouse.y=(g-e.displayOffsetY)*(1/e.scale),e.mouse.layer=!1)),e},a.PageElement.prototype.handleMouseOut=function(b){b=a.xt(b)?b:window.event;var c=scrawl.pad[b.target.id]||scrawl.stack[b.target.id]||scrawl.element[b.target.id]||!1;return c&&(c.mouse.active=!1),c},a.PageElement.prototype.initMouse=function(b){return this.mouse=a.newVector({name:this.type+"."+this.name+".mouse"}),this.position||(this.position=this.get("position")),b.mouse?(this.mouse.set(b.mouse),this.addMouseMove()):this.removeMouseMove(),this},a.PageElement.prototype.addMouseMove=function(){var a,b,c=this.getElement();return c.removeEventListener("mousemove",this.handleMouseMove,!1),c.addEventListener("mousemove",this.handleMouseMove,!1),c.removeEventListener("mouseout",this.handleMouseOut,!1),c.removeEventListener("mouseleave",this.handleMouseOut,!1),c.setAttribute("onmouseout","return;"),a="function"==typeof c.onmouseout,c.setAttribute("onmouseout",b),a?c.addEventListener("mouseout",this.handleMouseOut,!1):c.addEventListener("mouseleave",this.handleMouseOut,!1),this},a.PageElement.prototype.removeMouseMove=function(){var a=this.getElement();return a.removeEventListener("mousemove",this.handleMouseMove,!1),a.removeEventListener("mouseout",this.handleMouseOut,!1),a.removeEventListener("mouseleave",this.handleMouseOut,!1),this},a.Pad=function(b){b=a.safeObject(b),a.PageElement.call(this,b);var c,d,e,f="Pad";return a.xt(b.canvasElement)&&(a.canvas.PadConstructorTemporaryCanvas=b.canvasElement,this.display="PadConstructorTemporaryCanvas",a.xto([b.canvasElement.id,b.canvasElement.name])&&(f=b.canvasElement.id||b.canvasElement.name||f),a.PageElement.call(this,{name:f}),this.name.match(/~~~/)&&(this.name=this.name.replace(/~~~/g,"_")),b.canvasElement.id||(b.canvasElement.id=this.name),!a.contains(a.cellnames,this.name))?(this.cells=[],this.drawOrder=[],this.width=b.width||this.get("width"),this.height=b.height||this.get("height"),this.setDimensions(),a.pad[this.name]=this,a.pushUnique(a.padnames,this.name),b.length>1&&this.set(b),c=a.newCell({name:this.name,pad:this.name,canvas:b.canvasElement}),a.pushUnique(this.cells,c.name),this.display=c.name,delete a.canvas.PadConstructorTemporaryCanvas,d=b.canvasElement.cloneNode(!0),d.setAttribute("id",this.name+"_base"),e=a.newCell({name:this.name+"_base",pad:this.name,canvas:d,backgroundColor:b.backgroundColor}),a.pushUnique(this.cells,e.name),this.base=e.name,this.current=e.name,this.setDisplayOffsets(),a.xto([b.title,b.comment])&&this.setAccessibility(b),b.mouse=a.isa(b.mouse,"bool")||a.isa(b.mouse,"vector")?b.mouse:!0,this.initMouse(b),this):(console.log("Failed to generate a Pad controller - no canvas element supplied"),!1)},a.Pad.prototype=Object.create(a.PageElement.prototype),a.Pad.prototype.type="Pad",a.Pad.prototype.classname="padnames",a.d.Pad={drawOrder:[],cells:[],display:"",base:"",current:""},a.mergeInto(a.d.Pad,a.d.PageElement),a.Pad.prototype.getElement=function(){return a.canvas[this.display]},a.Pad.prototype.set=function(b){if(a.PageElement.prototype.set.call(this,b),b=a.safeObject(b),this.setDrawOrder(b.drawOrder||this.get("drawOrder")),a.isa(b.scale,"num")&&(a.cell[this.display].scale=b.scale,this.scale=b.scale),a.xt(b.width)&&(a.cell[this.display].set({width:b.width}),this.width=b.width),a.xt(b.height)&&(a.cell[this.display].set({height:b.height}),this.height=b.height),a.xto([b.start,b.startX,b.startY,b.handle,b.handleX,b.handleY,b.scale,b.width,b.height])&&this.setDisplayOffsets(),a.xto([b.backgroundColor,b.globalAlpha,b.globalCompositeOperation])){var c=a.cell[this.base];a.cell[this.base].set({backgroundColor:b.backgroundColor?b.backgroundColor:c.backgroundColor,globalAlpha:b.globalAlpha?b.globalAlpha:c.globalAlpha,globalCompositeOperation:b.globalCompositeOperation?b.globalCompositeOperation:c.globalCompositeOperation})
}return this},a.Pad.prototype.setDrawOrder=function(b){return this.drawOrder=a.xt(b)?[].concat(b):[],this},a.Pad.prototype.getCellsForDisplayAction=function(b){var c=[];if(a.isa(b,"arr"))c=b;else{for(var d=0,e=this.cells.length;e>d;d++)c.push(this.cells[d]);switch(b){case"all":break;case"display":c=[this.display];break;case"base":c=[this.base];break;case"non-base":a.removeItem(c,this.base);break;case"current":c=[this.current];break;case"non-current":a.removeItem(c,this.current);break;case"additionals":a.removeItem(c,this.display),a.removeItem(c,this.base);break;case"non-additionals":c=[this.display,this.base];break;case"none":c=[];break;default:a.removeItem(c,this.display)}}return c},a.Pad.prototype.clear=function(b){for(var c=this.getCellsForDisplayAction(b),d=0,e=c.length;e>d;d++)a.cell[c[d]].clear();return this},a.Pad.prototype.compile=function(b){for(var c=this.getCellsForDisplayAction(b),d=0,e=c.length;e>d;d++)a.cell[c[d]].compile();return this},a.Pad.prototype.stampBackground=function(b){for(var c=this.getCellsForDisplayAction(b),d=0,e=c.length;e>d;d++)a.cell[c[d]].stampBackground();return this},a.Pad.prototype.show=function(b){switch(b){case"wipe-base":a.cell[this.base].clear();break;case"wipe-both":a.cell[this.base].clear(),a.cell[this.display].clear();break;default:a.cell[this.display].clear()}if(this.drawOrder.length>0)for(var c=0,d=this.drawOrder.length;d>c;c++)a.cell[this.base].copyCellToSelf(a.cell[this.drawOrder[c]]);return a.cell[this.display].copyCellToSelf(a.cell[this.base],!0),this},a.Pad.prototype.render=function(b){return b=a.safeObject(b),this.clear(b.clear),this.compile(b.compile),this.show(b.show),this},a.Pad.prototype.addNewCell=function(b){var c,d;return b=a.safeObject(b),a.isa(b.name,"str")?(b.width=Math.round(b.width)||this.width,b.height=Math.round(b.height)||this.height,c=document.createElement("canvas"),c.setAttribute("id",b.name),c.setAttribute("height",b.height),c.setAttribute("width",b.width),b.pad=this.name,b.canvas=c,d=a.newCell(b),a.pushUnique(this.cells,d.name),d):!1},a.Pad.prototype.addCells=function(b){b=[].concat(b);for(var c=0,d=b.length;d>c;c++)a.contains(a.cellnames,b[c])&&(this.cells.push(b[c]),this.drawOrder.push(b[c]));return this},a.Pad.prototype.deleteCell=function(b){return a.isa(b,"str")?(a.removeItem(this.cells,b),this.display===b&&(this.display=this.current),this.base===b&&(this.base=this.current),this.current===b&&(this.current=this.base),this):(console.log("Pad.deleteCell error: argument is not a String"),this)},a.Pad.prototype.makeCurrent=function(){return a.currentPad=this.name,this},a.Pad.prototype.setAccessibility=function(b){b=a.xt(b)?b:{};var c=this.getElement();return a.xt(b.title)&&(this.title=b.title,c.title=this.title),a.xt(b.comment)&&(this.comment=b.comment,c.setAttribute("data-comment",this.comment),c.innerHTML="<p>"+this.comment+"</p>"),this},a.Pad.prototype.setDimensions=function(){var a=this.getElement();return a.width=this.width*this.scale,a.height=this.height*this.scale,this},a.Cell=function(b){return b=a.safeObject(b),a.xta([b,b.canvas])?(this.coreCellInit(b),this.animationCellInit(b),this.collisionsCellInit(b),this):(console.log("Cell constructor encountered an error: no canvas element supplied to it"),!1)},a.Cell.prototype=Object.create(a.Position.prototype),a.Cell.prototype.type="Cell",a.Cell.prototype.classname="cellnames",a.d.Cell={pad:"",source:{x:0,y:0,z:0},sourceWidth:300,sourceHeight:150,targetWidth:300,targetHeight:150,actualWidth:300,actualHeight:150,fieldLabel:"",globalAlpha:1,globalCompositeOperation:"source-over",backgroundColor:"rgba(0,0,0,0)",context:"",groups:[],usePadDimensions:!1},a.mergeInto(a.d.Cell,a.d.Position),a.Cell.prototype.coreCellInit=function(b){var c,d;a.Position.call(this,b),a.Base.prototype.set.call(this,b),a.canvas[this.name]=b.canvas,a.context[this.name]=b.canvas.getContext("2d"),a.cell[this.name]=this,a.pushUnique(a.cellnames,this.name),this.pad=b.pad||!1,c=a.safeObject(b.source),this.source=a.newVector({x:a.xt(b.sourceX)?b.sourceX:a.xt(c.x)?c.x:0,y:a.xt(b.sourceY)?b.sourceY:a.xt(c.y)?c.y:0,name:this.type+"."+this.name+".source"}),this.work.source=a.newVector({name:this.type+"."+this.name+".work.source"}),this.actualWidth=b.actualWidth||b.width||a.canvas[this.name].width,this.actualHeight=b.actualHeight||b.height||a.canvas[this.name].height,this.sourceWidth=this.actualWidth,this.sourceHeight=this.actualHeight,this.targetWidth=this.actualWidth,this.targetHeight=this.actualHeight,this.setDimensions(b),a.xto([b.targetX,b.targetY])&&(this.start.x=a.xt(b.targetX)?b.targetX:this.start.x,this.start.y=a.xt(b.targetY)?b.targetY:this.start.y),a.xto([b.sourceWidth,b.sourceHeight,b.targetWidth,b.targetHeight,b.width,b.height])&&(this.sourceWidth=b.sourceWidth||b.width||this.sourceWidth,this.sourceHeight=b.sourceHeight||b.height||this.sourceHeight,this.targetWidth=b.targetWidth||b.width||this.targetWidth,this.targetHeight=b.targetHeight||b.height||this.targetHeight),this.usePadDimensions=a.isa(b.usePadDimensions,"bool")?b.usePadDimensions:a.xto([b.sourceWidth,b.sourceHeight,b.targetWidth,b.targetHeight,b.width,b.height])?!1:!0,d=a.newContext({name:this.name,cell:a.context[this.name]}),this.context=d.name,this.flipUpend=a.xt(b.flipUpend)?b.flipUpend:a.d.Cell.flipUpend,this.flipReverse=a.xt(b.flipReverse)?b.flipReverse:a.d.Cell.flipReverse,this.lockX=a.xt(b.lockX)?b.lockX:a.d.Cell.lockX,this.lockY=a.xt(b.lockY)?b.lockY:a.d.Cell.lockY,this.roll=b.roll||a.d.Cell.roll,this.groups=a.xt(b.groups)?[].concat(b.groups):[],a.newGroup({name:this.name,cell:this.name})},a.Cell.prototype.collisionsCellInit=function(){},a.Cell.prototype.animationCellInit=function(){},a.Cell.prototype.get=function(b){if(a.contains(["targetX","targetY","sourceX","sourceY"],b))switch(b){case"targetX":return this.start.x;case"targetY":return this.start.y;case"sourceX":return this.source.x;case"sourceY":return this.source.y}if(a.contains(["target","source"],b))switch(b){case"target":return this.start.getVector();case"source":return this.source.getVector()}if(a.contains(["width","height"],b))switch(b){case"width":return this.usePadDimensions?this.getPadWidth():this.actualWidth;case"height":return this.usePadDimensions?this.getPadHeight():this.actualHeight}return this.animationCellGet(b)||a.Position.prototype.get.call(this,b)},a.Cell.prototype.animationCellGet=function(){return!1},a.Cell.prototype.set=function(b){var c;return a.Position.prototype.set.call(this,b),b=a.safeObject(b),a.xto([b.target,b.targetX,b.targetY])&&(c=a.safeObject(b.target),this.start.x=b.targetX||c.x||this.start.x,this.start.y=b.targetY||c.y||this.start.y),a.xto([b.source,b.sourceX,b.sourceY])&&(c=a.safeObject(b.source),this.source.x=b.sourceX||c.x||this.source.x,this.source.y=b.sourceY||c.y||this.source.y),a.xto([b.sourceWidth,b.sourceHeight,b.targetWidth,b.targetHeight,b.width,b.height])&&(this.sourceWidth=b.sourceWidth||b.width||this.sourceWidth,this.sourceHeight=b.sourceHeight||b.height||this.sourceHeight,this.targetWidth=b.targetWidth||b.width||this.targetWidth,this.targetHeight=b.targetHeight||b.height||this.targetHeight),a.xto([b.width,b.height,b.actualWidth,b.actualHeight])&&(this.actualWidth=b.actualWidth||b.width||this.actualWidth,this.actualHeight=b.actualHeight||b.height||this.actualHeight,this.setDimensions(b),a.ctx[this.context].getContextFromEngine(a.context[this.name])),this.animationCellSet(b),a.xto([b.handleX,b.handleY,b.handle,b.width,b.height,b.actualWidth,b.actualHeight,b.scale])&&(this.offset.flag=!1),this},a.Cell.prototype.animationCellSet=function(){},a.Cell.prototype.setDelta=function(b){var c;return a.Position.prototype.setDelta.call(this,b),b=a.safeObject(b),a.xto([b.source,b.sourceX,b.sourceY])&&(c=a.safeObject(b.source),this.source.x+=b.sourceX||c.x||0,this.source.y+=b.sourceY||c.y||0),a.xto([b.sourceWidth,b.sourceHeight])&&(this.sourceWidth+=b.sourceWidth||0,this.sourceHeight+=b.sourceHeight||0),a.xto([b.target,b.targetX,b.targetY])&&(c=a.safeObject(b.target),this.start.x+=b.targetX||c.x||0,this.start.y+=b.targetY||c.y||0),a.xto([b.targetWidth,b.targetHeight])&&(this.targetWidth+=b.targetWidth||0,this.targetHeight+=b.targetHeight||0),a.xt(b.globalAlpha)&&(this.globalAlpha+=b.globalAlpha),a.xto([b.handleX,b.handleY,b.handle,b.width,b.height,b.actualWidth,b.actualHeight,b.scale])&&(this.offset.flag=!1),this},a.Cell.prototype.getPadWidth=function(){return a.pad[this.pad].get("width")},a.Cell.prototype.getPadHeight=function(){return a.pad[this.pad].get("height")},a.Cell.prototype.setEngine=function(b){if(!b.fastStamp){var c,d,e,f,g=a.ctx[this.context],h=a.ctx[b.context],i=h.getChanges(g,b.scale,b.scaleOutline);if(i){delete i.count,c=a.context[this.name];for(var j in i){if(f=!1,j[0]<"m")if(j[0]<"l")switch(j){case"fillStyle":a.xt(a.design[i[j]])?(f=a.design[i[j]],a.contains(["Gradient","RadialGradient"],f.type)&&f.update(b.name,this.name),d=f.getData()):d=i[j],c.fillStyle=d;break;case"font":c.font=i[j];break;case"globalAlpha":c.globalAlpha=i[j];break;case"globalCompositeOperation":c.globalCompositeOperation=i[j]}else switch(j){case"lineCap":c.lineCap=i[j];break;case"lineDash":c.mozDash=i[j],c.lineDash=i[j];try{c.setLineDash(i[j])}catch(k){}break;case"lineDashOffset":c.mozDashOffset=i[j],c.lineDashOffset=i[j];break;case"lineJoin":c.lineJoin=i[j];break;case"lineWidth":c.lineWidth=i[j]}else if("s"==j[0])switch(j){case"shadowBlur":c.shadowBlur=i[j];break;case"shadowColor":c.shadowColor=i[j];break;case"shadowOffsetX":c.shadowOffsetX=i[j];break;case"shadowOffsetY":c.shadowOffsetY=i[j];break;case"strokeStyle":a.xt(a.design[i[j]])?(f=a.design[i[j]],a.contains(["Gradient","RadialGradient"],f.type)&&f.update(b.name,this.name),e=f.getData()):e=i[j],c.strokeStyle=e}else switch(j){case"miterLimit":c.miterLimit=i[j];break;case"textAlign":c.textAlign=i[j];break;case"textBaseline":c.textBaseline=i[j];break;case"winding":c.mozFillRule=i[j],c.msFillRule=i[j]}g[j]=i[j]}}}return b},a.Cell.prototype.clear=function(){var b=a.context[this.name];return b.setTransform(1,0,0,1,0,0),b.clearRect(0,0,this.actualWidth,this.actualHeight),this},a.Cell.prototype.compile=function(){"rgba(0,0,0,0)"!==this.get("backgroundColor")&&this.stampBackground(),this.groups.sort(function(b,c){return a.group[b].order-a.group[c].order});for(var b=0,c=this.groups.length;c>b;b++)a.group[this.groups[b]].get("visibility")&&a.group[this.groups[b]].stamp(!1,this.name);return this},a.Cell.prototype.stampBackground=function(){var b=a.context[this.name],c=this.get("backgroundColor"),d=this.actualWidth,e=this.actualHeight,f=b.fillStyle;return b.setTransform(1,0,0,1,0,0),b.fillStyle=c,b.fillRect(0,0,d,e),b.fillStyle=f,this},a.Cell.prototype.rotateDestination=function(b){var c=this.flipReverse?-1:1,d=this.flipUpend?-1:1,e=this.addPathRoll?(this.roll+this.pathRoll)*a.radian:this.roll*a.radian,f=Math.cos(e),g=Math.sin(e);return b.setTransform(f*c,g*c,-g*d,f*d,this.start.x,this.start.y),this},a.Cell.prototype.prepareToCopyCell=function(b){return this.resetWork(),this.offset.flag||(this.offset.set(this.getOffsetStartVector()),this.offset.flag=!0),this.pivot?this.setStampUsingPivot(a.pad[this.pad].base):this.pathPrepareToCopyCell(),this.rotateDestination(b),this},a.Cell.prototype.pathPrepareToCopyCell=function(){},a.Cell.prototype.copyCellToSelf=function(b,c){b=a.isa(b,"str")?a.cell[b]:b,c=a.xt(c)?c:!1;var d=b.get("lockTo"),e=d?a.cell[d]:b;if(a.xt(e)){var f=e.usePadDimensions,g=a.pad[e.pad],h=g.width,i=g.height,j=c?g.scale:this.scale,k=e.source.x||this.source.x,l=e.source.y||this.source.y,m=e.sourceWidth||this.sourceWidth,n=e.sourceHeight||this.sourceHeight,o=f?h*j:e.targetWidth*j,p=f?i*j:e.targetHeight*j,q=a.context[this.name],r=a.ctx[this.name],s=e.get("globalAlpha"),t=r.get("globalAlpha"),u=e.get("globalCompositeOperation"),v=r.get("globalCompositeOperation");s!==t&&(q.globalAlpha=s,r.set({globalAlpha:s})),u!==v&&(q.globalCompositeOperation=u,r.set({globalCompositeOperation:u})),a.context[e.name].setTransform(1,0,0,1,0,0),e.prepareToCopyCell(q),q.drawImage(a.canvas[e.name],k,l,m,n,e.offset.x,e.offset.y,o,p)}return this},a.Cell.prototype.clearShadow=function(){var b=a.context[this.name],c=a.ctx[this.context];return b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=0,c.set({shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0}),this},a.Cell.prototype.restoreShadow=function(b){var c=a.context[this.name],d=a.ctx[this.context],e=a.ctx[b],f=e.get("shadowOffsetX"),g=e.get("shadowOffsetY"),h=e.get("shadowBlur");return c.shadowOffsetX=f,c.shadowOffsetY=g,c.shadowBlur=h,d.set({shadowOffsetX:f,shadowOffsetY:g,shadowBlur:h}),this},a.Cell.prototype.setToClearShape=function(){var b=a.context[this.name],c=a.ctx[this.context];return b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(0, 0, 0, 0)",b.shadowColor="rgba(0, 0, 0, 0)",c.set({fillStyle:"rgba(0, 0, 0, 0)",strokeStyle:"rgba(0, 0, 0, 0)",shadowColor:"rgba(0, 0, 0, 0)"}),this},a.Cell.prototype.setDimensions=function(b){var c,d;return a.xt(b)&&!this.usePadDimensions?(c=b.width||b.actualWidth||this.actualWidth,d=b.height||b.actualHeight||this.actualHeight):(c=this.getPadWidth(),d=this.getPadHeight()),a.canvas[this.name].width=c,a.canvas[this.name].height=d,a.Base.prototype.set.call(this,{actualWidth:c,actualHeight:d}),this},a.Cell.prototype.saveContext=function(){return a.context[this.name].save(),this},a.Cell.prototype.restoreContext=function(){return a.context[this.name].restore(),this},a.Cell.prototype.getImageData=function(b){b=a.safeObject(b);var c=a.isa(b.name,"str")?this.name+"_"+b.name:this.name+"_imageData",d=a.isa(b.x,"num")?b.x:0,e=a.isa(b.y,"num")?b.y:0,f=a.isa(b.width,"num")?b.width:this.actualWidth,g=a.isa(b.height,"num")?b.height:this.actualHeight;return a.imageData[c]=a.context[this.name].getImageData(d,e,f,g),c},a.Context=function(b){return b=a.safeObject(b),a.Base.call(this,b),b.cell?this.getContextFromEngine(b.cell):this.set(b),a.ctx[this.name]=this,a.pushUnique(a.ctxnames,this.name),this},a.Context.prototype=Object.create(a.Base.prototype),a.Context.prototype.type="Context",a.Context.prototype.classname="ctxnames",a.d.Context={fillStyle:"#000000",winding:"nonzero",strokeStyle:"#000000",globalAlpha:1,globalCompositeOperation:"source-over",lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:[],lineDashOffset:0,miterLimit:10,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",font:"10pt sans-serif",textAlign:"start",textBaseline:"alphabetic"},a.contextKeys=Object.keys(a.d.Context),a.mergeInto(a.d.Context,a.d.Base),a.Context.prototype.setDelta=function(b){return b=a.safeObject(b),a.xt(b.lineDashOffset)&&(a.xt(this.lineDashOffset)||(this.lineDashOffset=a.d.Context.lineDashOffset),this.lineDashOffset+=b.lineDashOffset),a.xt(b.lineWidth)&&(a.xt(this.lineWidth)||(this.lineWidth=a.d.Context.lineWidth),this.lineWidth+=b.lineWidth,this.lineWidth<0&&(this.lineWidth=0)),a.xt(b.globalAlpha)&&(a.xt(this.globalAlpha)||(this.globalAlpha=a.d.Context.globalAlpha),this.globalAlpha+=b.globalAlpha,a.isBetween(this.globalAlpha,0,1,!0)||(this.globalAlpha=this.globalAlpha>.5?1:0)),this},a.Context.prototype.getContextFromEngine=function(b){for(var c=0,d=a.contextKeys.length;d>c;c++)this[a.contextKeys[c]]=b[a.contextKeys[c]];return this.winding=b.mozFillRule||b.msFillRule||"nonzero",this.lineDash=b.lineDash||[],this.lineDashOffset=b.mozDashOffset||b.lineDashOffset||0,this},a.Context.prototype.getChanges=function(b,c,d){for(var e,f,g={},h=0,i=0,j=a.contextKeys.length;j>i;i++)if(e=this.get(a.contextKeys[i]),a.contains(["lineWidth","shadowOffsetX","shadowOffsetY","shadowBlur"],a.contextKeys[i]))d?e*c!==b[a.contextKeys[i]]&&(g[a.contextKeys[i]]=e*c,h++):e!==b[a.contextKeys[i]]&&(g[a.contextKeys[i]]=e,h++);else if(a.contains(["fillStyle","strokeStyle","shadowColor"],a.contextKeys[i])&&a.contains(a.designnames,e)&&"Color"===a.design[e].type)f=a.design[e].getData(),f!==b[a.contextKeys[i]]&&(g[a.contextKeys[i]]=f,h++);else if(a.contains(["fillStyle","strokeStyle"],a.contextKeys[i])&&a.contains(a.designnames,e)&&a.contains(["Gradient","RadialGradient"],a.design[e].type)&&a.design[e].autoUpdate)g[a.contextKeys[i]]=e,h++;else if(a.contains(["lineDash"],a.contextKeys[i])&&a.xt(b.lineDash)){if(e.length!==b.lineDash.length)g.lineDash=e,h++;else for(var k=0,l=e.length;l>k;k++)if(e[k]!==b.lineDash[k]){g.lineDash=e,h++;break}}else a.contains(["name","timestamp"],a.contextKeys[i])||e!==b[a.contextKeys[i]]&&(g[a.contextKeys[i]]=e,h++);return h>0?g:!1},a.Group=function(b){return b=a.safeObject(b),a.Base.call(this,b),this.sprites=a.xt(b.sprites)?[].concat(b.sprites):[],this.cell=b.cell||a.pad[a.currentPad].current,this.order=b.order||0,this.visibility=a.isa(b.visibility,"bool")?b.visibility:!0,this.spriteSort=a.isa(b.spriteSort,"bool")?b.spriteSort:!0,this.regionRadius=b.regionRadius||0,a.group[this.name]=this,a.pushUnique(a.groupnames,this.name),a.pushUnique(a.cell[this.cell].groups,this.name),this},a.Group.prototype=Object.create(a.Base.prototype),a.Group.prototype.type="Group",a.Group.prototype.classname="groupnames",a.d.Group={sprites:[],cell:"",order:0,visibility:!0,spriteSort:!0,regionRadius:0},a.mergeInto(a.d.Group,a.d.Base),a.Group.prototype.sortSprites=function(){this.spriteSort&&this.sprites.sort(function(b,c){return a.sprite[b].order-a.sprite[c].order})},a.Group.prototype.forceStamp=function(a,b){var c=this.visibility;return c||this.set({visibility:!0}),this.stamp(a,b),this.set({visibility:c}),this},a.Group.prototype.stamp=function(b,c){if(this.visibility){this.sortSprites();for(var d=0,e=this.sprites.length;e>d;d++)a.sprite[this.sprites[d]].stamp(b,c)}return this},a.Group.prototype.addSpritesToGroup=function(b){b=a.xt(b)?[].concat(b):[];for(var c=0,d=b.length;d>c;c++)a.pushUnique(this.sprites,b[c]);return this},a.Group.prototype.removeSpritesFromGroup=function(b){b=a.xt(b)?[].concat(b):[];for(var c=0,d=b.length;d>c;c++)a.removeItem(this.sprites,b[c]);return this},a.Group.prototype.updateSpritesBy=function(b){b=a.safeObject(b);for(var c=0,d=this.sprites.length;d>c;c++)a.sprite[this.sprites[c]].setDelta({startX:b.x||b.startX||0,startY:b.y||b.startY||0,scale:b.scale||0,roll:b.roll||0});return this},a.Group.prototype.setSpritesTo=function(b){for(var c=0,d=this.sprites.length;d>c;c++)a.sprite[this.sprites[c]].set(b);return this},a.Group.prototype.pivotSpritesTo=function(b){b=a.isa(b,"str")?b:!1;var c,d,e,f;if(b&&(c=a.sprite[b]||(a.xt(a.point)?a.point[b]:!1))){d="Point"===c.type?c.get("current"):c.start;for(var g=0,h=this.sprites.length;h>g;g++)e=a.sprite[this.sprites[g]],f=a.v.set(e.start),f.vectorSubtract(d),e.set({pivot:b,handleX:-f.x,handleY:-f.y})}return this},a.Group.prototype.getSpriteAt=function(b){b=a.safeObject(b);var c,d,e=a.v.set({x:b.x||0,y:b.y||0});e=a.Position.prototype.correctCoordinates(e,this.cell),this.sortSprites();for(var f=this.sprites.length-1;f>=0;f--)if(c=a.sprite[this.sprites[f]],!(this.regionRadius&&(c.resetWork(),d=c.work.start.vectorSubtract(e),d.getMagnitude()>this.regionRadius))&&c.checkHit({x:e.x,y:e.y}))return c;return!1},a.Group.prototype.getAllSpritesAt=function(b){b=a.safeObject(b);var c,d,e=a.v.set({x:b.x||0,y:b.y||0}),f=[];e=a.Position.prototype.correctCoordinates(e,this.cell),this.sortSprites();for(var g=this.sprites.length-1;g>=0;g--)c=a.sprite[this.sprites[g]],this.regionRadius&&(c.resetWork(),d=c.work.start.vectorSubtract(e),d.getMagnitude()>this.regionRadius)||c.checkHit(e)&&f.push(c);return f.length>0?f:!1},a.Sprite=function(b){b=a.safeObject(b),a.Position.call(this,b),b.name=this.name;var c=a.newContext(b);return this.context=c.name,this.group=this.getGroup(b),this.fastStamp=b.fastStamp||!1,this.scaleOutline=a.isa(b.scaleOutline,"bool")?b.scaleOutline:!0,this.order=b.order||0,this.visibility=a.isa(b.visibility,"bool")?b.visibility:!0,this.method=b.method||a.d[this.type].method,this.collisionsSpriteConstructor(b),this},a.Sprite.prototype=Object.create(a.Position.prototype),a.Sprite.prototype.type="Sprite",a.Sprite.prototype.classname="spritenames",a.d.Sprite={order:0,visibility:!0,method:"fill",data:"",radius:0,scaleOutline:!0,fastStamp:!1,context:"",group:""},a.mergeInto(a.d.Sprite,a.d.Position),a.Sprite.prototype.collisionsSpriteConstructor=function(){},a.Sprite.prototype.registerInLibrary=function(){return a.sprite[this.name]=this,a.pushUnique(a.spritenames,this.name),a.group[this.group].addSpritesToGroup(this.name),this.collisionsSpriteRegisterInLibrary(),this},a.Sprite.prototype.collisionsSpriteRegisterInLibrary=function(){},a.Sprite.prototype.get=function(b){return a.xt(a.d.Base[b])?a.Base.prototype.get.call(this,b):a.xt(a.d.Context[b])?a.ctx[this.context].get(b):a.Position.prototype.get.call(this,b)},a.Sprite.prototype.set=function(b){return a.Position.prototype.set.call(this,b),a.ctx[this.context].set(b),b=a.safeObject(b),a.xt(b.group)&&(a.group[this.group].removeSpritesFromGroup(this.name),this.group=this.getGroup(b.group),a.group[this.group].addSpritesToGroup(this.name)),this.collisionsSpriteSet(b),a.xto([b.handleX,b.handleY,b.handle,b.width,b.height,b.radius,b.scale])&&(this.offset.flag=!1),this},a.Sprite.prototype.collisionsSpriteSet=function(){},a.Sprite.prototype.setDelta=function(b){a.Position.prototype.setDelta.call(this,b),b=a.safeObject(b);var c=a.ctx[this.context];return a.xto([b.lineDashOffset,b.lineWidth,b.globalAlpha])&&c.setDelta(b),this.roll+=b.roll||0,this.width+=b.width||0,this.height+=b.height||0,a.xto([b.handleX,b.handleY,b.handle,b.width,b.height,b.radius,b.scale])&&(this.offset.flag=!1),this},a.Sprite.prototype.clone=function(b){b=a.safeObject(b);var c,d,e=JSON.parse(JSON.stringify(a.ctx[this.context]));return delete e.name,d=a.mergeInto(b,e),delete d.context,c=a.Position.prototype.clone.call(this,d),a.xt(b.createNewContext)&&!b.createNewContext&&(delete a.ctx[c.context],a.removeItem(a.ctxnames,c.context),c.context=this.context),c},a.Sprite.prototype.getGroup=function(b){return b=a.safeObject(b),a.xt(b.group)&&a.contains(a.groupnames,b.group)?b.group:a.pad[a.currentPad].current},a.Sprite.prototype.forceStamp=function(a,b){var c=this.visibility;return this.visibility=!0,this.stamp(a,b),this.visibility=c,this},a.Sprite.prototype.prepareStamp=function(){return this.offset.flag||(this.offset.set(this.getOffsetStartVector()),this.offset.flag=!0),this.offset},a.Sprite.prototype.stamp=function(b,c){if(this.visibility){var d=a.isa(c,"str")&&a.contains(a.cellnames,c)?a.cell[c]:a.cell[a.group[this.group].cell],e=a.context[d.name],f=a.isa(b,"str")?b:this.method;this.pivot?this.setStampUsingPivot(d.name):this.pathStamp(),this.callMethod(e,d.name,f)}return this},a.Sprite.prototype.pathStamp=function(){},a.Sprite.prototype.callMethod=function(a,b,c){switch(c){case"clear":this.clear(a,b);break;case"clearWithBackground":this.clearWithBackground(a,b);break;case"draw":this.draw(a,b);break;case"fill":this.fill(a,b);break;case"drawFill":this.drawFill(a,b);break;case"fillDraw":this.fillDraw(a,b);break;case"sinkInto":this.sinkInto(a,b);break;case"floatOver":this.floatOver(a,b);break;case"clip":this.clip(a,b);break;case"none":this.none(a,b)}return this},a.Sprite.prototype.rotateCell=function(b){var c=this.flipReverse?-1:1,d=this.flipUpend?-1:1,e=this.addPathRoll?(this.roll+this.pathRoll)*a.radian:this.roll*a.radian,f=Math.cos(e),g=Math.sin(e);return b.setTransform(f*c,g*c,-g*d,f*d,this.start.x,this.start.y),this},a.Sprite.prototype.clear=function(){return this},a.Sprite.prototype.clearWithBackground=function(){return this},a.Sprite.prototype.draw=function(){return this},a.Sprite.prototype.fill=function(){return this},a.Sprite.prototype.drawFill=function(){return this},a.Sprite.prototype.fillDraw=function(){return this},a.Sprite.prototype.sinkInto=function(){return this},a.Sprite.prototype.floatOver=function(){return this},a.Sprite.prototype.clip=function(){return this},a.Sprite.prototype.none=function(b,c){return a.cell[c].setEngine(this),this},a.Sprite.prototype.clearShadow=function(b,c){var d=a.ctx[this.context];return(d.shadowOffsetX||d.shadowOffsetY||d.shadowBlur)&&a.cell[c].clearShadow(),this},a.Sprite.prototype.restoreShadow=function(b,c){var d=a.ctx[this.context];return(d.shadowOffsetX||d.shadowOffsetY||d.shadowBlur)&&a.cell[c].restoreShadow(this.context),this},a.Sprite.prototype.pickupSprite=function(b){b=a.safeObject(b);var c=a.v.set({x:b.x||0,y:b.y||0}),d=a.cell[a.group[this.group].cell];return c=this.correctCoordinates(c,d),this.oldX=c.x||0,this.oldY=c.y||0,this.realPivot=this.pivot,this.set({pivot:"mouse",order:this.order+9999}),this},a.Sprite.prototype.dropSprite=function(a){var b=this.order;return this.set({pivot:a||this.realPivot||!1,order:b>=9999?b-9999:0}),delete this.realPivot,delete this.oldX,delete this.oldY,this},a.Sprite.prototype.checkHit=function(b){b=a.safeObject(b);var c,d,e=a.cvx,f=a.xt(b.tests)?[].concat(b.tests):[b.x||!1,b.y||!1];this.rotateCell(e),c=this.prepareStamp(),e.beginPath(),e.rect(c.x,c.y,this.width*this.scale,this.height*this.scale);for(var g=0,h=f.length;h>g&&!(d=e.isPointInPath(f[g],f[g+1]));g+=2);return d?{x:f[g],y:f[g+1]}:!1},a.Design=function(b){return a.Base.call(this,b),this},a.Design.prototype=Object.create(a.Base.prototype),a.Design.prototype.type="Design",a.Design.prototype.classname="designnames",a.d.Design={color:[{color:"black",stop:0},{color:"white",stop:.999999}],setToSprite:!1,cell:"",startX:0,startY:0,endX:0,endY:0,startRangeX:1,startRangeY:1,endRangeX:1,endRangeY:1},a.mergeInto(a.d.Design,a.d.Base),a.Design.prototype.setDelta=function(b){b=a.safeObject(b);var c={};return b.startX&&(c.startX=this.get("startX")+b.startX),b.startY&&(c.startY=this.get("startY")+b.startY),b.startRadius&&(c.startRadius=this.get("startRadius")+b.startRadius),b.endX&&(c.endX=this.get("endX")+b.endX),b.endY&&(c.endY=this.get("endY")+b.endY),b.endRadius&&(c.endRadius=this.get("endRadius")+b.endRadius),b.startRangeRadius&&(c.startRangeRadius=this.get("startRangeRadius")+b.startRangeRadius),b.endRangeRadius&&(c.endRangeRadius=this.get("endRangeRadius")+b.endRangeRadius),b.startRangeX&&(c.startRangeX=this.get("startRangeX")+b.startRangeX),b.startRangeY&&(c.startRangeY=this.get("startRangeY")+b.startRangeY),b.endRangeX&&(c.endRangeX=this.get("endRangeX")+b.endRangeX),b.endRangeY&&(c.endRangeY=this.get("endRangeY")+b.endRangeY),b.roll&&a.xt(a.d.Design.roll)&&(c.roll=this.get("roll")+b.roll),this.set(c),this},a.Design.prototype.update=function(a,b){return this.makeGradient(a,b),this.applyStops(),this},a.Design.prototype.getData=function(){return a.xt(a.dsn[this.name])?a.dsn[this.name]:"rgba(0,0,0,0)"},a.Design.prototype.makeGradient=function(b,c){c=a.xt(c)?a.cell[c]:a.cell[this.get("cell")],b=a.sprite[b];var d,e,f,g,h,i=a.context[c.name],j=b.getOffsetStartVector();switch(this.type){case"Gradient":if(this.get("setToSprite")){switch(b.type){case"Wheel":h=j.x-b.radius*b.scale,e=j.y-b.radius*b.scale,g=h+2*b.radius*b.scale,f=e+2*b.radius*b.scale;break;case"Shape":h=j.x-b.width/2*b.scale,e=j.y-b.height/2*b.scale,g=h+b.width*b.scale,f=e+b.height*b.scale;break;default:h=j.x,e=j.y,g=h+b.width*b.scale,f=e+b.height*b.scale}h*=this.get("startRangeX"),e*=this.get("startRangeY"),g*=this.get("endRangeX"),f*=this.get("endRangeY")}else h=-b.start.x+this.get("startX"),e=-b.start.y+this.get("startY"),g=-b.start.x+(this.get("endX")||c.actualWidth),f=-b.start.y+(this.get("endY")||c.actualHeight);d=i.createLinearGradient(h,e,g,f);break;case"RadialGradient":this.setToSprite?d=i.createRadialGradient(this.get("startX"),this.get("startY"),this.get("startRadius")*this.get("startRangeRadius"),this.get("endX"),this.get("endY"),this.get("endRadius")*this.get("endRangeRadius")):(h=this.get("startX")-b.start.x,g=this.get("startY")-b.start.y,e=this.get("endX")-b.start.x,f=this.get("endY")-b.start.y,d=i.createRadialGradient(h,g,this.get("startRadius"),e,f,this.get("endRadius")));break;default:d=!1}return a.dsn[this.name]=d,this},a.Design.prototype.applyStops=function(){var b=this.get("color");if(a.dsn[this.name])for(var c=0,d=b.length;d>c;c++)a.dsn[this.name].addColorStop(b[c].stop,b[c].color);return this},a.Design.prototype.remove=function(){return delete a.dsn[this.name],delete a.design[this.name],a.removeItem(a.designnames,this.name),!0},a.Gradient=function(b){return b=a.safeObject(b),a.Design.call(this,b),a.Base.prototype.set.call(this,b),a.design[this.name]=this,a.pushUnique(a.designnames,this.name),this},a.Gradient.prototype=Object.create(a.Design.prototype),a.Gradient.prototype.type="Gradient",a.Gradient.prototype.classname="designnames",a.d.Gradient={},a.mergeInto(a.d.Gradient,a.d.Design),a.Gradient.prototype.swap=function(){var a=this.get("startX"),b=this.get("startY"),c=this.get("endX"),d=this.get("endY");return this.set({startX:c,startY:d,endX:a,endY:b}),this.update(),this},a.RadialGradient=function(b){return b=a.safeObject(b),a.Design.call(this,b),a.Base.prototype.set.call(this,b),a.design[this.name]=this,a.pushUnique(a.designnames,this.name),this},a.RadialGradient.prototype=Object.create(a.Design.prototype),a.RadialGradient.prototype.type="RadialGradient",a.RadialGradient.prototype.classname="designnames",a.d.RadialGradient={startRadius:0,endRadius:0,startRangeRadius:.5,endRangeRadius:0},a.mergeInto(a.d.RadialGradient,a.d.Design),a.RadialGradient.prototype.swap=function(){var a=this.get("startX"),b=this.get("startY"),c=this.get("startRadius"),d=this.get("endY"),e=this.get("endY"),f=this.get("endRadius");return this.set({startX:d,startY:e,startRadius:f,endX:a,endY:b,endRadius:c}),this.update(),this},a.v=a.newVector({name:"scrawl.v"}),a.workquat={q1:a.newQuaternion({name:"scrawl.workquat.q1"}),q2:a.newQuaternion({name:"scrawl.workquat.q2"}),q3:a.newQuaternion({name:"scrawl.workquat.q3"}),q4:a.newQuaternion({name:"scrawl.workquat.q4"}),q5:a.newQuaternion({name:"scrawl.workquat.q5"})},a}();